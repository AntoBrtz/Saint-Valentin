<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Saint Valentin - Voulez-vous √™tre ma Valentine ?</title>
  <style>
    :root {
      --rose: #e91e63;
      --rose-dark: #c2185b;
      --rose-light: #f8bbd0;
      --blanc: #ffffff;
      --rouge: #e53935;
      --fond: #fff7fb;
      --shadow: rgba(0,0,0,.08);
      --bg-grad1: #ffe4ec;
      --bg-grad2: #fff3f9;
    }

    html, body {
      min-height: 100vh;
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-grad1), var(--bg-grad2));
      background-attachment: fixed;
      background-size: cover;
      background-repeat: no-repeat;
      position: relative;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: hidden;
      overflow-y: auto;
      padding: 20px 0;
    }

    /* D√©cor discret: c≈ìurs flottants */
    .decor {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .decor .heart {
      position: absolute;
      color: rgba(233, 30, 99, 0.6);
      font-size: 20px;
      animation: float 18s linear infinite;
      top: -30px;
      left: 0;
      opacity: 0.5;
    }
    @keyframes float {
      0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.5; }
      50% { transform: translateY(60vh) translateX(20px) rotate(180deg); opacity: 0.3; }
      100% { transform: translateY(120vh) translateX(-10px) rotate(360deg); opacity: 0; }
    }
    /* C≈ìurs tr√®s l√©gers en fond */
    .decor-heart {
      position: fixed;
      width: 140px; height: 140px;
      right: -20px; bottom: -20px;
      background: radial-gradient(circle, rgba(233,30,99,.25) 0 40%, transparent 41%);
      transform: rotate(25deg);
      filter: saturate(120%);
      pointer-events: none;
      opacity: .25;
      border-radius: 50%;
      animation: drift 40s ease-in-out infinite alternate;
      z-index: 0;
    }
    @keyframes drift {
      0% { transform: translate(0,0) rotate(0deg); }
      100% { transform: translate(-20px, -20px) rotate(-8deg); }
    }

    /* Carte principale */
    .card {
      position: relative;
      z-index: 1;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 28px;
      max-width: 720px;
      width: 92%;
      box-shadow: 0 20px 40px var(--shadow);
      text-align: center;
      overflow: visible;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.9rem;
      margin: 8px 0 12px;
      color: var(--rose-dark);
      letter-spacing: .4px;
    }

    .question {
      font-size: 1.1rem;
      margin-bottom: 16px;
    }

    .choices {
      display: inline-flex;
      gap: 16px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .btn {
      appearance: none;
      border: 2px solid var(--rose-dark);
      border-radius: 999px;
      padding: 12px 22px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform .15s ease, background .3s ease, color .3s ease;
      background: var(--rose);
      color: white;
      box-shadow: 0 4px 0 rgba(0,0,0,.08);
    }

    .btn.secondary {
      background: white;
      color: var(--rose-dark);
      border: 2px solid var(--rose-dark);
      box-shadow: 0 4px 0 rgba(0,0,0,.06);
    }

    .btn:active { transform: translateY(2px); }

    /* Tremblement pour Non sur click */
    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 260ms ease-in-out; }

    /* Section chronom√®tre */
    #countdown {
      font-family: monospace;
      font-size: 1.4rem;
      color: var(--rose-dark);
      margin: 14px 0 6px;
      word-break: break-word;
      line-height: 1.4;
    }

    #love-message {
      font-size: 1.2rem;
      color: var(--rose-dark);
      margin-top: 10px;
      font-weight: 500;
      line-height: 1.4;
    }

    .hidden { display: none; }

    /* Zone finale */
    #finale {
      display: none;
      text-align: center;
      margin-top: 18px;
    }

    #finale img {
      max-width: 100%;
      max-height: 70vh;
      width: auto;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,.1);
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      object-fit: contain;
    }

    #finale img:hover {
      transform: scale(1.02);
      box-shadow: 0 8px 25px rgba(0,0,0,.15);
    }

    #finale img:active {
      transform: scale(0.98);
    }

    #finale p {
      color: #c0392b;
      font-size: 1.05rem;
      margin-top: 12px;
    }

    .download-hint {
      font-size: 0.9rem;
      color: var(--rose-dark);
      margin-top: 8px;
      font-style: italic;
      opacity: 0.8;
    }

    #download-link {
      display: inline-block;
      text-decoration: none;
    }

    /* Bouton musique en forme de c≈ìur */
    .fab {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 56px; 
      height: 56px;
      border: none;
      background: linear-gradient(135deg, var(--rose), var(--rose-dark));
      color: white;
      box-shadow: 0 8px 20px rgba(0,0,0,.15);
      display: grid;
      place-items: center;
      cursor: pointer;
      z-index: 9999;
      transition: transform .2s ease;
      /* Forme de c≈ìur */
      clip-path: path('M28,52 C12,40 0,30 0,18 C0,8 6,0 14,0 C20,0 25,3 28,8 C31,3 36,0 42,0 C50,0 56,8 56,18 C56,30 44,40 28,52 Z');
      opacity: 1;
      visibility: visible;
    }
    .fab:active { transform: scale(0.98); }
    .fab:hover { transform: scale(1.05); }

    .fab-icon {
      width: 28px; height: 28px;
      display: inline-block;
      line-height: 1;
      font-size: 20px;
    }

    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); border: 0;
    }

    /* Musique courte indication sur petit texte pr√®s de l'ic√¥ne (accessibilit√©) */
    .audio-tooltip {
      position: fixed;
      bottom: 82px;
      right: 18px;
      background: rgba(0,0,0,.75);
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .2s ease, transform .2s ease;
      pointer-events: none;
      white-space: nowrap;
      z-index: 9998;
    }
    .fab:hover + .audio-tooltip, .audio-tooltip.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    /* Responsive */
    @media (max-width: 420px) {
      h1 { font-size: 1.5rem; }
      .btn { padding: 10px 18px; font-size: 0.95rem; }
      #countdown { font-size: 1.1rem; }
      #love-message { font-size: 1rem; }
      .card { padding: 20px; width: 95%; }
      .question { font-size: 1rem; }
      .fab { width: 50px; height: 50px; right: 12px; bottom: 12px; }
      .fab-icon { font-size: 18px; }
      .audio-tooltip { bottom: 70px; right: 12px; font-size: 11px; }
    }

    @media (max-width: 360px) {
      h1 { font-size: 1.3rem; }
      .btn { padding: 8px 16px; font-size: 0.9rem; }
      #countdown { font-size: 1rem; }
      #love-message { font-size: 0.95rem; }
      .card { padding: 16px; }
      .choices { gap: 12px; }
    }
  </style>
</head>
<body>
  <!-- d√©cor discret: c≈ìurs flottants -->
  <div class="decor" aria-hidden="true" id="decor"></div>
  <div class="decor-heart" aria-hidden="true"></div>

  <div class="card" aria-label="Message de Saint Valentin">
    <h1>Pour ma ch√©rie</h1>
    <div class="question" id="question-text">Veux-tu √™tre ma Valentine ?</div>

    <div class="choices" id="choices">
      <button id="btn-oui" class="btn" type="button" aria-label="Oui">Oui</button>
      <button id="btn-non" class="btn secondary" type="button" aria-label="Non">Non</button>
    </div>

    <div id="countdown" aria-live="polite" class="hidden"></div>
    <div id="love-message" class="hidden">Je t'aime fort ‚ù§Ô∏è</div>

    <div id="finale" aria-label="Finale">
      <a id="download-link" href="img/Dessin-Saint-Valentin.JPG" download="Dessin-Saint-Valentin.JPG">
        <img id="finale-img" src="img/IMG_0773 2.PNG" alt="Pour ma ch√©rie" />
      </a>
      <p class="download-hint">üëÜ Clique sur l'image pour t√©l√©charger la version compl√®te</p>
      <p>Merci pour tout ! Bonne Saint-Valentin √† toi, je t'aime ma ch√©rie ‚ù§Ô∏è</p>
    </div>
  </div>

  <!-- Ic√¥ne musique en forme de c≈ìur (en dehors de la carte) -->
  <button class="fab" id="toggle-audio" aria-label="Contr√¥ler la musique" title="Contr√¥ler la musique">
    <span class="fab-icon" id="fab-icon">üîä</span>
  </button>
  <div class="audio-tooltip" id="audio-tooltip" role="status" aria-live="polite">Musique</div>

  <span class="sr-only" id="sr-audio-status">Musique √©teinte</span>
  <audio id="valentine-audio" loop preload="auto">
    <source src="Lil_Peep_-_Life_Is_Beautiful.mp3" type="audio/mpeg">
    Votre navigateur ne supporte pas l'√©l√©ment audio.
  </audio>

  <script>
    // Calcul du prochain 14 f√©vrier √† minuit
    function getTargetDate() {
      const now = new Date();
      const year = now.getFullYear();
      const targetYear = (now.getMonth() > 1 || (now.getMonth() === 1 && now.getDate() > 14)) ? year + 1 : year;
      return new Date(targetYear, 1, 14, 0, 0, 0, 0);
    }

    const btnOui = document.getElementById('btn-oui');
    const btnNon = document.getElementById('btn-non');
    const countdownEl = document.getElementById('countdown');
    const finaleEl = document.getElementById('finale');
    const finaleImg = document.getElementById('finale-img');
    const choicesEl = document.getElementById('choices');
    let timerInterval = null;

    // Musique et ic√¥ne
    const audio = document.getElementById('valentine-audio');
    const toggleAudioBtn = document.getElementById('toggle-audio');
    const fabIcon = document.getElementById('fab-icon');
    const audioTooltip = document.getElementById('audio-tooltip');
    const srAudioStatus = document.getElementById('sr-audio-status');
    let audioUnlocked = false;
    let isPlaying = false;

    // Tremble du Non sur clic
    function trembleNon() {
      btnNon.classList.add('shake');
      setTimeout(() => btnNon.classList.remove('shake'), 320);
    }

    // D√©marrer le compte √† rebours jusqu'au 14 f√©vrier
    function startCountdown() {
      const target = getTargetDate();
      const loveMessage = document.getElementById('love-message');

      function update() {
        const now = new Date();
        let diff = target - now;
        if (diff <= 0) {
          clearInterval(timerInterval);
          countdownEl.classList.add('hidden');
          loveMessage.classList.add('hidden');
          finaleEl.style.display = 'block';
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff -= days * (1000 * 60 * 60 * 24);
        const hours = Math.floor(diff / (1000 * 60 * 60));
        diff -= hours * (1000 * 60 * 60);
        const minutes = Math.floor(diff / (1000 * 60));
        diff -= minutes * (1000 * 60);
        const seconds = Math.floor(diff / 1000);

        countdownEl.textContent = `Rendez-vous ici dans: ${days}j ${hours}h ${minutes}m ${seconds}s`;
      }

      countdownEl.classList.remove('hidden');
      loveMessage.classList.remove('hidden');
      update();
      timerInterval = setInterval(update, 1000);
    }

    // Oui: d√©sactiver et lancer compte
    function onOuiSelected() {
      btnOui.disabled = true;
      btnNon.disabled = true;
      btnNon.classList.remove('shake');
      startCountdown();
    }

    // Non: tremble sur clic, pas de mouvement continu
    function onNonSelected() {
      trembleNon();
      // l√©ger micro-d√©placement visuel temporaire
      const randX = Math.floor((Math.random() * 6) - 3);
      btnNon.style.transform = `translateX(${randX}px)`;
      setTimeout(() => { btnNon.style.transform = ''; }, 120);
      // Pas d'autre action
    }

    // Musique: contr√¥le via ic√¥ne
    function updateAudioIcon(playing) {
      if (playing) {
        fabIcon.textContent = '‚è∏';
        srAudioStatus.textContent = 'Musique: On';
        audioTooltip.textContent = 'Musique activ√©e (cliquez pour pause)';
      } else {
        fabIcon.textContent = '‚ñ∂';
        srAudioStatus.textContent = 'Musique: Off';
        audioTooltip.textContent = 'Musique arr√™t√©e (cliquez pour jouer)';
      }
    }

    function toggleAudio() {
      console.log('Toggle audio clicked, paused:', audio.paused);
      if (audio.paused) {
        const playPromise = audio.play();
        if (playPromise !== undefined) {
          playPromise
            .then(() => {
              console.log('Audio playing successfully');
              audioUnlocked = true;
              isPlaying = true;
              updateAudioIcon(true);
              showTooltipBriefly();
            })
            .catch((err) => {
              console.log('Lecture bloqu√©e:', err);
              updateAudioIcon(false);
              alert('Veuillez cliquer √† nouveau pour activer la musique');
            });
        }
      } else {
        audio.pause();
        console.log('Audio paused');
        isPlaying = false;
        updateAudioIcon(false);
        showTooltipBriefly();
      }
    }

    function showTooltipBriefly() {
      audioTooltip.classList.add('show');
      setTimeout(() => audioTooltip.classList.remove('show'), 1200);
    }

    // Tentative de lecture automatique au chargement
    function tryAutoplay() {
      console.log('Trying autoplay...');
      const playPromise = audio.play();
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            console.log('Autoplay successful');
            audioUnlocked = true;
            isPlaying = true;
            updateAudioIcon(true);
          })
          .catch((err) => {
            console.log('Autoplay bloqu√© (normal):', err);
            // La lecture automatique est bloqu√©e, attendre l'interaction
            updateAudioIcon(false);
            audioTooltip.textContent = 'Cliquez pour activer la musique';
            audioTooltip.classList.add('show');
            setTimeout(() => audioTooltip.classList.remove('show'), 2500);
          });
      }
    }

    // Init d√©cor avec c≈ìurs flottants
    function initDecor() {
      const decor = document.getElementById('decor');
      const decoCount = 30;
      for (let i = 0; i < decoCount; i++) {
        const heart = document.createElement('div');
        heart.className = 'heart';
        heart.textContent = '‚ù§';
        
        const size = Math.random() * 15 + 10;
        heart.style.fontSize = size + 'px';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.top = -(Math.random() * 100) + 'px';
        
        const colors = ['#e91e63', '#ff5a83', '#ff1744', '#f50057'];
        heart.style.color = colors[Math.floor(Math.random() * colors.length)];
        heart.style.opacity = (Math.random() * 0.5 + 0.3).toFixed(2);
        heart.style.animationDuration = (Math.random() * 12 + 10) + 's';
        heart.style.animationDelay = (Math.random() * 5) + 's';
        
        decor.appendChild(heart);
      }
    }

    btnOui.addEventListener('click', onOuiSelected);
    btnNon.addEventListener('click', onNonSelected);
    toggleAudioBtn.addEventListener('click', toggleAudio);

    // Init
    initDecor();
    
    // Essayer de lancer la musique automatiquement
    window.addEventListener('load', () => {
      setTimeout(tryAutoplay, 500);
    });
  </script>
</body>
</html>
